using CryptoBase;
using CryptoBase.Abstractions.SymmetricCryptos;
using CryptoBase.BouncyCastle.SymmetricCryptos.StreamCryptos;
using CryptoBase.SymmetricCryptos.StreamCryptos.ChaCha20Original;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using System;

namespace UnitTest
{
	[TestClass]
	public class ChaCha20OriginalTest
	{
		private static void Test(SnuffleCryptoBase crypto, string inputHex, string outputHex)
		{
			Assert.AreEqual(@"ChaCha20Original", crypto.Name);
			Assert.AreEqual(8, crypto.IvSize);

			Span<byte> i = inputHex.FromHex();
			Span<byte> o = outputHex.FromHex();
			Span<byte> o1 = stackalloc byte[i.Length];

			crypto.Update(i, o1);
			Assert.IsTrue(o1.SequenceEqual(o));

			crypto.Reset();

			crypto.Update(i, o1);
			Assert.IsTrue(o1.SequenceEqual(o));

			crypto.Dispose();
		}

		[TestMethod]
		[DataRow(@"0A5DB00356A9FC4FA2F5489BEE4194E73A8DE03386D92C7FD22578CB1E71C417",
			@"1F86ED54BB2289F0",
			@"000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
			@"A2590E1FB8142241D7CDBAD75DA35762A2C71E2D5CD650FA5E090C91D9E3A2EF5550E94A5939ED559F0DBF5E802DA83AC340D5148C1C147C2432ED9CF61D9C6BF68C20446F8E1C144190C6DC270661C86375E7B5023C16E7144CBE5A945313E001BCDC5A99B2F87B8D8A036D2BE83EC219826ACF7BB259100BA9525F2D71E3CF666434768F72D05B57E257D6688B51E06507EF5541AE99ED9BB8C1A83A4BD7F4589691DA7A68D3B44EB945E779476B13061338FF18AA0B88BF4B557E2D7B2E36F7463B43D4FB053903ED42EEB192FD649E00200FAA15179DA494AD8198E7A4601CBF29FBE297191D026B293FE2D6F949C9D6688E283EF3C83CB896EF35DED0")]
		[DataRow(@"3A8DE03386D92C7FD22578CB1E71C417",
			@"1F86ED54BB2289F0",
			@"000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
			@"6C0962D7BD66E54FCA23C27E0F2EE84475817264DFE9EB845FA9BB1FD6FD8EE4BEFE109A878DD118506BCA4B7A32BA7811E326AFB953DC20FB3962FF6270C95E0BBDD612FF6D4E35828C812A3423483B6782CEAA0A2F552B1DBA2FFA12D89CF934BA2E017F3BB7DD10CF859FA145C1072763F23F106644791C428967D9CA5372E75A7C04FD03D72732919A2735C9B89EAD3F146CF4C25447D3885D4264689A31DACD4D8D867984CD2553B5CF2E5C07AEF3AD1D170B9EFAC2144EF7C09C0F4FAD09CCE452989A08E37E5260534B53AD0FB0238A626FF9F5913FEB452D0A47DA4D53BDC20703EBCFD6F119A37E761305FC0011978425F93595FDF250EAE2ED9B")]
		[DataRow(@"1C9240A5EB55D38AF333888604F6B5F0473917C1402B80099DCA5CBC207075C0",
				@"1C00000000000000",
				@"49EEE0DC249040CDC5408F4705BCDD8147C68DE6B18FD7CB090E6E22481FBFB85CF71E8AC123F2D4194B010F4EA443CE01C667DA03911890A5A48E4503B32DAC7492D35347C8DD25536C0203870D110C58E31218FD2A5B400C30F0B83F43CEAE653A7D7CF454AACC3397C377BAC570DED7D513A565C45F0F461A0D97B5F3BB3C840F2BC5AAEAF26CC9B50CEE15F37DBE9F7B5AA6AE4F83B6794941F45818CB867F300EF87D4436EA75EB8884403CAD4F6F316BAA5DE5A5C52166E9A7E3B2158878F679A15947124E9F9F641AA0225B08BE7C36C22B66331BDD6071F7478C61C3DA8A781E16FA1E8681A6172AA7B5C2E7A4C742F1CF6ACAB445CFF393F0E7EAF6F4E633438493A5679B165858800F2B5C2474757F9581B7307A33A7F794873227105D144C4329DD26BD3E3C0EFE0EA510EA6B64FD73C6EDECA8C9BFB3BA0B4D0770FC16FD791ED7C5494E1C8B8D791BB1ECCA60094C6AD50949460088228DCEEAB11711DE42D223C17211F55073044047F95DE7A726B17EB03F58C152AB12679D3F434B68D49C6838078A2D3EF3AF6A4BF9E5316922F9A669C69C969A1235951D95D5DDBEBF935324FDEBC20A64B077006F88C43718697CD74192554C03A19A4B15E5DF7F373372C18B1067A3015794257B38717EDD1ECC7355D28EEB07DDF1DA58B14790FE422172A3547AA040EC9FDDC6846ECAAEE368B49DE478FF57F2F81B03A131D9DE8DF5229CDD20A41E27B1764F4455E29BA19CFE54F7271BF4DE02F51B55485CDC214B9E4B6EED4623DC65B2CF795F28E09E8BE74C9D8AFFC1A628B865698A4529EF7485DE79C708AE30B0F4A31D5141ABCECBF6B5D86DE085E198B343BB86830AA0F5B7040BFA711FB0F6D9130015F0C7EB0D5A9FD7B96C651422456E45323E7E601A12978214FBAA0422FAA0E57E8C7802485D78335A7CADDB29CEBB8B61A4B742E2AC8B1AD92F0B8B622183357EAD73C2B56C10263807E5C73680E2231261F5484B2BC5DF15D98701AAAC1E7CAD73781863E08B9F81D8126A2810BE04688A097C1B1C8366804780E8FD351C976FAE491066CCC6D8CC3A8491207772E424D2379FC5C92594105F40006499DCAED72109785015AC5FC62CA20BA939876E6DABDE085116C713E9EAED068E2CF8378CF0A6968D43B69837B243EDDEDF891AE7EB9DA17B0B77B0E275C0F198D98055C93491D159E84B0FC1A94B7A840620A85DFAD1DE70562F9E919C20B324D8843DE18C7E6252E5444B9FC29303EA2B59C5FA3F912BBB23F5B27BF538AFB3EE63DC7BD1FFAA8BAB826B3704EB74BE79B98390EF205946FFE9973E2FEEB66418384C7A4AF961E89AA1B501A647D311D4CED3914988C7B84DB1B9076D1672AE465E03A14BB60230A83DA9072A7C19E76287E3822F6FE109D99497EADD589EAE767E35E5B4DA7EF4DEF73287CD93BF11",
				@"32B49FE7B7B334F63FBBF94E2243E06504EC8C9C50B1A3685AE4B777FEC2711D9BFD3276621378D27CD9AA2B755834CEC5FCB6D082DE7E8AF947B70EAE0C1F5DD26886C036C1C8A5A46E9427671E62645EB2E757410F759EA39ED8F70A66DB096BF39CA67D011EAA739125B9FCD30C647E9ED2D3FBDC494FDDBDAF6EC1DDA599219E514BBF316B8DAAE1F5DB73B19DA99261139E05778A011E83531A03B81AC164796BF3D085F54D6B64CC1651860AD2C3E2CEC8CE9CB085CF9D9724D560F695DFC4EF7833683ABFBD4585558E0770021B71E40F122123D0FD98865DD8BF8B31741730D3C7B1B6C276F6EDEE7BD462E86CE871C0F30B7043AF618158DE910632C031C025D0620A2C14187D415EC67202E864F895CB5BB3EC96E211BE939C680F9C136D8CBEDE54D230004DD2737FD7DA9962934657A569C14B6BD0AB64494A27F3E2FCE45461D03B94764EFB4FF6C437D9B6ED8DD04B16559CCE8CF609E0409607F76D99FD0E1DB558E505CF7F3499CF86F6E6AB5E821B7AC4E4F21FFEB09298AAC309E1055A935800943DBC598FADF63971744F0869CB2B4AC05790552F448AD7C53740AB12171AE74DC4FE1758407CD2454DEC2A1674B2B8850B2787801DF9910D9B7AF9AC7ABC1F751F55FE67056247627578FD71EE68D72315937DEF31056D80D470975EDB498C9352FA45271601BCD5B6289080BC28022EB0873104F77AEF0913BD35E1657C9F5CF5D8F23E50190271CBD93B96154AF4607D10473F3CC82361D9F12E2005FD263594E505D14DB5EAE557BD333138705E12CD9CC4AB088849E3F226F287CF53908A5AEA02C2102E05B4FCEB0F58B681443C0F1FFAAED9104206686354E344A2CFFFA88281478DCCEBF41B77012C04B5BDF969F16CD2E77B50A5347702118178C2DE3548BB38B96F0604A4AEE7DE80E21DA476267034FF346E135089BD9CDABDCDA1FA401BC0FBAEAA87149343BCF9BD69F53B9F62D3420782EC409DDBE58EFB3E2D4EF08BE975A30973A83466654B703F26137FD60118405EDC6A627E974618A70393D05EDAA3F24EFE8B96599FEF4458B6926581C3409693E9BA6ED223306F8B5E401336037BB86DFCC23D4194E471E52130D2F627E095D6BF63C070C7859F8B19FE55984B7A5E2C4F2F543AD38602E2A89ED860BE497ED1A51772DC2D6C1A5D84052414272844E54E1BA55B8F47A7E3D278A90EB20DC6D4B5ADE78DB775819B4B87BE03D3A8B49CE73CBF50C4C670A58C3A301C8BD427420D0B92DB29380462F297D5A1A98E80B45C23BE814B389CCE83F670E13565C705AD8FF94B63032FA264B0BCC5CC3561569431F8892D57F932173EB8B944E8BE41896BBBDEF1E292B3DAD42919591267F6A03802A5DCBFB6590F9400AB82572583CE78D61D456D3812D899C07592A4E984AE90F8FB03D17CCA238EF34E50BC")]
		public void Test(string keyHex, string ivHex, string inputHex, string hex)
		{
			var key = keyHex.FromHex();
			var iv = ivHex.FromHex();
			Test(new BcChaCha20OriginalCrypto(key, iv), inputHex, hex);
			Test(new ChaCha20OriginalCryptoSF(key, iv), inputHex, hex);
			Test(new ChaCha20OriginalCryptoX86(key, iv), inputHex, hex);
			Test(StreamCryptoCreate.ChaCha20Original(key, iv), inputHex, hex);
		}
	}
}
